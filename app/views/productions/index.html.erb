<div class="container-fluid mt-5">
</div>

<h1>Mes productions</h1>
<br>

<div class="card mb-4">
  <div class="card-header bg-success text-white">
    Liste des Productions
  </div>
  <div class="card-body">
    <table class="table table-striped table-bordered table-hover table-sm" style="table-layout: auto; width: 100%;">
      <thead class="thead-dark">
        <tr>
          <th>Processus</th>
          <th>Matière Première</th>
          <th>Quantité Utilisée (kg)</th>
          <th>Quantité Gaspillée (kg)</th>
          <th>Émissions CO₂ (kg)</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        <% @productions.each do |production| %>
        <tr>
          <td><%= production.process_name %></td>
          <td>
            <% production.production_raw_materials.each do |prm| %>
            <p>
              <%= prm.raw_material.name %> : <%= prm.quantity_used %>
            </p>
            <% end %>
          </td>
          <td>
            <%= production.production_raw_materials.sum(&:quantity_used) %>
          </td>
          <td>
            <%= production.production_raw_materials.sum { |prm| prm.raw_material.waste_rate * prm.quantity_used } %>
          </td>
          <td>
            <%= production.production_raw_materials.sum { |prm| prm.raw_material.co2_per_kg * prm.quantity_used * prm.raw_material.waste_rate } %>
          </td>
          <td>
            <div class="btn-group">
              <%= link_to "Modifier", edit_production_path(production), class: "btn btn-primary btn-sm me-2" %>
              <%= button_to "Supprimer", production_path(production), method: :delete, data: { confirm: "Êtes-vous sûr de vouloir supprimer ce processus ?" }, class: "btn btn-warning btn-sm" %>
            </div>
          </td>
        </tr>
        <% end %>
      </tbody>
    </table>
    <%= link_to "Ajouter production", new_production_path, class: "btn btn-success mt-3" %>
  </div>
</div>